flowchart TD
    root(("ðŸŽ¯ Service Responsibilities Architecture"))

    %% --- Admin Service ---
    root --> AdminService["ðŸ”§ Admin Service - Control Plane"]
    AdminService --> BroadcastLifecycle["ðŸŸ¦ Broadcast Lifecycle Management"]
    BroadcastLifecycle --> CreateBroadcast["ðŸŸ¢ Create New Broadcasts"]
    BroadcastLifecycle --> CancelBroadcast["ðŸ”´ Cancel Active Broadcasts"]
    BroadcastLifecycle --> ExpireBroadcast["ðŸŸ¡ Auto-Expire Old Broadcasts"]

    AdminService --> UserTargeting["ðŸŸª User Targeting & Pre-computation"]
    UserTargeting --> AudienceSelection["ðŸ”µ Audience Selection Logic"]
    UserTargeting --> PreCalculation["ðŸŸ  Pre-calculate User Lists"]
    UserTargeting --> SegmentationRules["ðŸŸ£ Segmentation Rules"]

    AdminService --> EventGeneration["ðŸŸ¨ Event Generation - Messaging"]
    EventGeneration --> TransactionalOutbox["ðŸŸ« Transactional Outbox Pattern"]
    EventGeneration --> ReliablePublishing["ðŸ”· Reliable Event Publishing"]
    EventGeneration --> EventConsistency["ðŸ”¶ Event Ordering & Consistency"]

    AdminService --> DLTManagement["ðŸŸ§ DLT Management - Dead Letter Topics"]
    DLTManagement --> ConsumeFailedMessages["âš« Consume Failed Messages"]
    DLTManagement --> RedriveAPIs["ðŸ”˜ Provide Redrive APIs"]
    DLTManagement --> ErrorRecovery["ðŸŸ¥ Error Recovery Mechanisms"]

    AdminService --> AdminAnalytics["ðŸŸ© Admin Analytics & Queries"]
    AdminAnalytics --> PerformanceMetrics["ðŸ“ˆ Broadcast Performance Metrics"]
    AdminAnalytics --> HistoricalData["ðŸ”Ž Query Historical Data"]
    AdminAnalytics --> ReportingData["ðŸ“Š Reporting Dashboard Data"]

    %% --- User Service ---
    root --> UserService["ðŸš€ User Service - Delivery Plane"]
    UserService --> SSEConnection["ðŸŸ¦ SSE Connection Management"]
    SSEConnection --> ConcurrentUsers["ðŸŒŸ Handle 30k+ Concurrent Users"]
    SSEConnection --> ConnectionPool["ðŸ”— Real-time Connection Pool"]
    SSEConnection --> HealthChecks["ðŸ’š Heartbeat & Health Checks"]

    UserService --> EventConsumption["ðŸŸª Event Consumption - Message Processing"]
    EventConsumption --> Orchestrator["ðŸ‘‘ Orchestrator Leader Node"]
    EventConsumption --> Workers["ðŸ‘· Worker Follower Nodes"]
    EventConsumption --> LoadDistribution["âš–ï¸ Load Distribution Logic"]

    UserService --> DistributedState["ðŸŸ¨ Distributed State - User Tracking"]
    DistributedState --> OnlineUsers["ðŸ”´ Track Online Users in Redis"]
    DistributedState --> SessionState["ðŸ”µ Session State Management"]
    DistributedState --> CrossInstance["ðŸŒ Cross-Instance Coordination"]

    UserService --> UserActions["ðŸŸ§ Handle User Actions - Interactions"]
    UserActions --> MarkAsRead["âœ… Mark as Read Functionality"]
    UserActions --> PreferenceUpdates["âš™ï¸ User Preference Updates"]
    UserActions --> RealtimeProcessing["âš¡ Real-time Action Processing"]

    UserService --> UserSpecificData["ðŸŸ© Serve User-Specific Data"]
    UserSpecificData --> InboxCaching["ðŸ“¦ Inbox Caching Strategy"]
    UserSpecificData --> PersonalizedRetrieval["ðŸŽ¯ Personalized Data Retrieval"]
    UserSpecificData --> FastExperience["ðŸš€ Fast User Experience"]

    %% --- Shared Components ---
    root --> SharedComponents["ðŸ”— Shared Components - Common Infrastructure"]
    SharedComponents --> BroadcastSharedModule["ðŸŸ¦ broadcast-shared Module"]
    BroadcastSharedModule --> DataModels["ðŸŸ¢ Data Models Entities"]
    BroadcastSharedModule --> DatabaseRepos["ðŸ”µ Database Repositories"]
    BroadcastSharedModule --> DTOs["ðŸŸ¡ DTOs Data Transfer Objects"]
    BroadcastSharedModule --> JavaSpringConfig["ðŸŸ£ Common Java Spring Config"]

    SharedComponents --> SharedInfrastructure["ðŸŸª Shared Infrastructure - Backend Services"]
    SharedInfrastructure --> PostgreSQL["ðŸ˜ PostgreSQL Database"]
    SharedInfrastructure --> RedisCache["âš¡ Redis Cache Layer"]
    SharedInfrastructure --> KafkaBroker["ðŸ“¡ Kafka Message Broker"]

    %% --- Styling ---
    classDef root fill:#f3f4f6,stroke:#111827,stroke-width:2px,color:#111827;
    classDef group fill:#e0f2fe,stroke:#0284c7,stroke-width:2px,color:#0c4a6e;
    classDef leaf1 fill:#dcfce7,stroke:#16a34a,stroke-width:1.5px,color:#064e3b;
    classDef leaf2 fill:#fee2e2,stroke:#dc2626,stroke-width:1.5px,color:#7f1d1d;
    classDef leaf3 fill:#fef9c3,stroke:#eab308,stroke-width:1.5px,color:#78350f;
    classDef leaf4 fill:#e0e7ff,stroke:#4338ca,stroke-width:1.5px,color:#312e81;
    classDef leaf5 fill:#fbcfe8,stroke:#db2777,stroke-width:1.5px,color:#831843;
    classDef infra fill:#ede9fe,stroke:#7c3aed,stroke-width:1.5px,color:#4c1d95;

    %% Apply classes
    class root root
    class AdminService,UserService,SharedComponents group
    class BroadcastLifecycle,UserTargeting,EventGeneration,DLTManagement,AdminAnalytics group
    class SSEConnection,EventConsumption,DistributedState,UserActions,UserSpecificData group
    class BroadcastSharedModule,SharedInfrastructure infra

    class CreateBroadcast,PerformanceMetrics,ConcurrentUsers,DataModels leaf1
    class CancelBroadcast,OnlineUsers,RedisCache leaf2
    class ExpireBroadcast,DTOs,RealtimeProcessing leaf3
    class AudienceSelection,SessionState,DatabaseRepos leaf4
    class SegmentationRules,Workers,JavaSpringConfig leaf5
