sequenceDiagram
    participant AdminSvc as Admin Service
    participant Kafka as Kafka (Orchestration)
    participant Orchestrator as User Service (Orchestrator)
    participant Geode as Apache Geode
    participant TargetedWorker as Worker Pod (Targeted)
    participant AllWorkers as All Worker Pods

    Note over AdminSvc, Kafka: Admin cancels a broadcast, an event is published via the Outbox...

    Kafka->>+Orchestrator: Consumes CANCELLED event
    Orchestrator->>Orchestrator: Checks broadcast type

    alt Targeted Broadcast (e.g., ROLE/SELECTED)
        Orchestrator->>+DB: Fetches list of all affected users
        DB-->>-Orchestrator: Returns user list

        loop For each targeted user
            Orchestrator->>+Geode: "Scatters" user-specific event into 'sse-user-messages'
        end
        Geode-->>-Orchestrator: ...

        Note over Geode, TargetedWorker: Geode CQ notifies the specific worker pod responsible for the user.
        Geode-->>+TargetedWorker: CqListener is invoked with event
        TargetedWorker->>TargetedWorker: Pushes 'MESSAGE_REMOVED' via SSE to the specific user
    else ALL Broadcast
        Orchestrator->>+Geode: Puts ONE generic event into 'sse-group-messages'
        Geode-->>-Orchestrator: ...

        Note over Geode, AllWorkers: Geode CQ notifies ALL worker pods subscribed to the group region.
        Geode-->>+AllWorkers: CqListeners on ALL pods are invoked
        AllWorkers->>AllWorkers: Each pod pushes 'MESSAGE_REMOVED' via SSE to all its connected users
    end
    
    Orchestrator-->>-Kafka: Acknowledges orchestration event