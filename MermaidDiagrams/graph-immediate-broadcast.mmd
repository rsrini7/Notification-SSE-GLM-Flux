graph TD
    subgraph "Start"
        A["Admin Creates an Immediate Broadcast <br/> (ALL, ROLE, or SELECTED)"]
    end

    A --> C[Admin Service publishes ONE <br/> orchestration event via the Outbox Pattern];
    subgraph "Orchestration (Fan-out on Read)"
        C --> D[Kafka: broadcast-orchestration topic];
        D --> E["User Service (Orchestrator Pod) <br/> consumes the single event"];
        E --> F["Dynamically determines target user list <br/> & looks up their pod locations in Redis"];
        F --> G["'Scatters' N user-specific events <br/> to pod-specific Redis channels"];
    end
    
    subgraph "Delivery (Worker Pods)"
        G --> J["Redis: Pub/Sub Channels <br/> (e.g., notifications:cluster:pod-name)"];
        J --> K["User Service (Worker Pods) <br/> receive events from their subscribed Redis channel"];
        K --> L[Push message to online user via SSE <br/> or cache for offline user in Redis];
    end